function EndPoint(i){this.coordinates={x:null,y:null},this.img=document.getElementById(i),this.initLayer=function(i,t){this.coordinates.x=i.path[i.path.length-1][0]*i.config.grid,this.coordinates.y=i.path[i.path.length-1][1]*i.config.grid,this.img.style.backgroundImage="undefined"===t?"url(./img/icon_item_10000012.png)":"url(./img/"+t+")",this.img.style.display="block",this.img.style.position="absolute",this.img.style.width="30px",this.img.style.height="30px",this.img.style.backgroundSize="30px 30px",this.img.style.left=this.coordinates.x+2+"px",this.img.style.top=this.coordinates.y+2+"px"}}function Layer(i){this.coordinates={x:null,y:null},this.img=document.getElementById(i),this.initLayer=function(i,t,s,o){var h=Math.floor(Math.random()*i.path.length);this.coordinates.x=void 0==s?i.path[h][0]*i.config.grid+6:s+6,this.coordinates.y=void 0==s?i.path[h][1]*i.config.grid+6:o+6,this.img.style.backgroundImage="url(./img/"+t+")",this.img.style.display="block",this.img.style.position="absolute",this.img.style.width="20px",this.img.style.height="18px",this.img.style.backgroundSize="70px 70px",this.img.style.left=this.coordinates.x+"px",this.img.style.top=this.coordinates.y+"px",this.ctx=i.ctx,this.pathPos=h},this.moveUp=function(){isCollsion(this.ctx,this.img,this.coordinates.x,this.coordinates.y-1)||(this.img.style.backgroundPosition="-2px 18px",--this.coordinates.y,this.move())},this.moveDown=function(){isCollsion(this.ctx,this.img,this.coordinates.x,this.coordinates.y+1)||(this.img.style.backgroundPosition="-2px 70px",++this.coordinates.y,this.move())},this.moveLeft=function(){isCollsion(this.ctx,this.img,this.coordinates.x-1,this.coordinates.y)||(this.img.style.backgroundPosition="-2px 52px",--this.coordinates.x,this.move())},this.moveRight=function(){isCollsion(this.ctx,this.img,this.coordinates.x+1,this.coordinates.y)||(this.img.style.backgroundPosition="-2px 35px",++this.coordinates.x,this.move())},this.move=function(i,t,s,o){this.img.style.left=this.coordinates.x+"px",this.img.style.top=this.coordinates.y+"px"}}function isCollsion(i,t,s,o){for(var h=i.getImageData(s,o,18,18),e=h.data,g=0;n=e.length,g<n;g+=4){var a=e[g],c=e[g+1],l=e[g+2],r=e[g+3];if(0==a&&0==c&&0==l&&0==r)return!0}return!1}function Maze(i){this.config=i,this.book=[],this.path=[],this.wall=[],this.init=function(i){if(i)for(var t in i)this.config[t]=i[t];this.book=[],this.path=[],this.wall=[],this.updateCssStyle(),this.dfs(0,0),this.drawWaze()},this.updateCssStyle=function(){var i=document.getElementById("mazeDiv");i.style.width=this.config.mazeWidth*this.config.grid+"px",i.style.height=this.config.mazeHeight*this.config.grid+"px"},this.dfs=function(i,t){var s,o,h=0,n=this.config.mazeWidth,e=this.config.mazeHeight;for(this.path.push([i,t]),this.book[i*n+t]=this.generateRandomDirections();4>h;h++)s=i+this.book[i*n+t][h][0],o=t+this.book[i*n+t][h][1],0>s||s>1*n-1||0>o||o>1*e-1||this.book[s*n+o]||(this.wall.push([(i+s)/2,(t+o)/2]),this.dfs(s,o))},this.generateRandomDirections=function(){for(var i=[[1,0],[-1,0],[0,1],[0,-1]],t=0,s=[];t<i.length;t++){var o=Math.floor(4*Math.random());s[t]=i[t],i[t]=i[o],i[o]=s[t]}return i},this.drawWaze=function(){var i=document.getElementById(this.config.mazeId);i.height=this.config.mazeHeight*this.config.grid,i.width=this.config.mazeWidth*this.config.grid,this.ctx=i.getContext("2d"),this.ctx.fillStyle=this.config.wallColor,this.ctx.fillStyle=this.config.roadColor,this.ctx.clearRect(0,0,this.config.mazeWidth*this.config.grid,this.config.mazeHeight*this.config.grid);for(var t=0;t<this.wall.length;t++)this.ctx.fillRect(this.wall[t][0]*this.config.grid,this.wall[t][1]*this.config.grid,this.config.road,this.config.road);for(var t=0;t<this.path.length;t++)this.ctx.fillRect(this.path[t][0]*this.config.grid,this.path[t][1]*this.config.grid,this.config.road,this.config.road);this.ctx.stroke()}}